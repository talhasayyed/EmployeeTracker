<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ECharts Line + Pie Combo</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
  <style>
    .card {
      width: 90%;
      max-width: 1000px;
      margin: 40px auto;
      padding: 20px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    #combochart {
      width: 100%;
      height: 600px;
    }
    h2 {
      margin: 0 0 20px;
      font-size: 22px;
      text-align: center;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="card">
    <h2>Beverage Sales Over Years</h2>
    <div id="combochart"></div>
  </div>

  <script>
    async function loadChart() {
      // fetch dataset from Flask backend
      const response = await fetch("/data");
      const dataset = await response.json();

      const chartDom = document.getElementById("combochart");
      const myChart = echarts.init(chartDom);

      const option = {
        legend: {},
        tooltip: {
          trigger: "axis",
          showContent: false
        },
        dataset: { source: dataset },
        xAxis: { type: "category" },
        yAxis: { gridIndex: 0 },
        grid: { top: "55%" },
        series: [
          { type: "line", smooth: true, seriesLayoutBy: "row", emphasis: { focus: "series" } },
          { type: "line", smooth: true, seriesLayoutBy: "row", emphasis: { focus: "series" } },
          { type: "line", smooth: true, seriesLayoutBy: "row", emphasis: { focus: "series" } },
          { type: "line", smooth: true, seriesLayoutBy: "row", emphasis: { focus: "series" } },
          {
            type: "pie",
            id: "pie",
            radius: "30%",
            center: ["50%", "25%"],
            emphasis: { focus: "self" },
            label: {
              formatter: "{b}: {@2012} ({d}%)"
            },
            encode: {
              itemName: "product",
              value: "2012",
              tooltip: "2012"
            }
          }
        ]
      };

      myChart.on("updateAxisPointer", function (event) {
        const xAxisInfo = event.axesInfo[0];
        if (xAxisInfo) {
          const dimension = xAxisInfo.value + 1;
          myChart.setOption({
            series: {
              id: "pie",
              label: {
                formatter: "{b}: {@[" + dimension + "]} ({d}%)"
              },
              encode: {
                value: dimension,
                tooltip: dimension
              }
            }
          });
        }
      });

      myChart.setOption(option);
    }

    loadChart();
  </script>
</body>
</html>
